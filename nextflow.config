//export NXF_WORK="./nextflow_zwc"
params {
    h =null
    help =null
    fastq_filelist = "/research_jude/rgs01_jude/groups/cab/projects/automapper/common/zhongshan/Analysis2024/NTU_RNAseq_Fastqs/DIVIA_RUN/DIVIA_TALL_Run_AML/test/DIVIA_Samplesheet_test.txt"
    //"/research_jude/rgs01_jude/groups/wugrp/projects/NTU/common/TCGA_AML/DIVIA_Run/DIVIA_Sample_Fastqlist.txt" 
    //"/research/groups/cab/projects/automapper/common/wzhang42/Downsample_AML/DIVIA_Samplesheet_Fastqlist.txt" 
    // "/research/groups/cab/projects/automapper/common/zhongshan/Analysis2024/NTU_RNAseq_Fastqs/DIVIA_RUN/DIVIA_TALL_New2024_ZW/TALL_new2024.list" 
    // "/research/groups/cab/projects/automapper/common/zhongshan/Analysis2024/NTU_RNAseq_Fastqs/DIVIA_RUN/DIVIA_TALL/DIVIA_NTU_TALL_Samplelist.txt" 
    //"/research/groups/cab/projects/automapper/common/wzhang42/AML_27OCT2023_n658/AML_n658_Sample_Fastqlist.txt"
    // "/research/groups/cab/projects/automapper/common/wzhang42/KLCO_AML_n1034/ITD_Valid/DIVIA_ITD_Complete_Test/Sample_Fastqlist.txt"
    //"/research/groups/cab/projects/automapper/common/zhongshan/test/NGS_Pipelines/arc-Apr-2022/Run_DIVIA/NTU_Samplelist.txt" 
    //"/research/groups/cab/projects/automapper/common/wzhang42/E1910_RNA_n35/Sample_Fastqlist.txt"         
    // a txt file that recording the fastq file list. Each row have three columns as samplename \t Fastq block \t and Strandness. Fastq block contain R1 block and R2 block, which are separted by space.  multiple LANE's fastq separated by comma.  
   
    project = "DIVIA_TALL_Run_AML_n53_rhel8" // "DIVIA_E1910_RNA_Cluster" // "DIVIA_E1910_RNA" //"NTU_BALL_Cluster_12_25_2022"  
    // A project atlas for the current BALL Molecular Classfication       
    
    Lineage_Type = "AML"
    // Linage Type. BALL (Default) |TALL | AML

    ChrName_withChr="Y"
    // Chromosome Name can be with the prefix 'chr' such as "chr1, chr2..." and without prefix 'chr' only as numbers '1,2,...'. Y(Default)| N. 

    Select_Trim_Galore = "N"
    // Whether select Trim_Galore for trimming reads and FastQC before STAR Mapping. Y(Default) | N 

    Select_Fusion_Catcher ="Y"
    // Whether select Fusion_Catcher for Fusion Detection. Y(Default) | N 

    Select_STAR_Fusion = "Y"
    // Whether select STAR_Fusion for Fusion Detection. Y(Default) | N

    Select_Arriba_Fusion = "Y"
    // Whether select Arriba for Fusion Detection. Y(Default) | N
    
    Select_Pindel = "Y"
    // Whether select Pindel for detecting the breakpoints of large deletions, insertions, inversions, and tandem duplications. Y(Default) | N

    Select_iAdmix = "Y"
    // Whether select iAdmix to estimate admixture coefficients from aligned BAM. Y(Default) | N
    
    Select_GATK = "Y"
    // Whether select GATK for rna variant calling. Y(Default) | N

    Select_Haplo_PerChrom ="N"
    // Whether select run HaplotypeCalle parallelly Chrom by chrom, which can speed up Haplotypecaller calling.  Y (Default) |N.

    Select_VarDict ="Y"
    // Whether select to VarDict for Variant calling.  Y (Default) |N.
     
    Select_Variant_ANNOVAR = "Y"
    // Whether select ANNOVAR for Variant Annotation. Y(Default) | N
  
    Select_RSEM = "Y"
    // Whether select RSEM for rnaseq quantification. Y(Default) | N
  
    Select_ML_Classifier_RANK = "Y"
    // Whether select the RSEM' Gene EXpression data for downstream ML_Classifier RANK . Y(Default) | N
   
    Select_ML_Classifier_tSNE = "N"
    // Whether select the RSEM' Gene EXpression data for downstream ML_Classifier tSNE. Y(Default) | N
    
    Select_ML_Classifier_RF = "N"
    // Whether select the RSEM' Gene EXpression data for downstream ML_Classifier RandomForest. Y(Default) | N
   
    Select_RNASeqCNV = "Y"
    // Whether select RNASeqCNV for RNAseq CNV calling. Y(Default) | N

    Select_RNAIndel = "Y"
    // Whether select RNAIndel for calling coding indels from tumor RNA-Seq data and classifying them as somatic, germline, and artifactual. Y(Default) | N

    AUTO_DIR="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation"
    REF_DIR= "${AUTO_DIR}/REF/Homo_sapiens/NCBI"
   
    Fusion_Catcher {
       data_dir ="/hpcf/authorized_apps/rhel7_apps/fusioncatcher/1.33/fusioncatcher-1.33/data/human_v102"
       // The data directory where all the annotations files from Ensembl database are placed, This directory should be pre-built using 'fusioncatcher-build'.
       ThreadN = 4 
       // Thread Number for Fusion_Catcher
    }

    STAR_Mapping {
       ThreadN = 2
       // Thread Number for STAR Mapping
       STAR_Index="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/STAR-index/2.7.9a"
//"/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/STAR-index/2.7.9a"
       //"/home/wzhang42/BALL_Classifier/nf_core/Reference/star"
       // The path for STAR INDEX, which can be generated by STAR run_Mode genomeGenerate 
       // sjdbGTFfile="/home/wzhang42/BALL_Classifier/nf_core/Reference/ensembl/Homo_sapiens.GRCh38.102.chr.gtf"
       // The path for STAR sjdbGTF file
    }

    STAR_Fusion {
        ThreadN = 4
       // Thread Number for STAR_Fusion
       Ref="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/CTAT/lib_May232022"
//"/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/CTAT/lib_May232022"
       //"/home/wzhang42/BALL_Classifier/nf_core/Reference/starfusion/ctat_genome_lib_build_dir"     
       // The path for STAR_Fusion Reference, which can be generated by STAR run_Mode genomeGenerate  
    }

    Arriba_Fusion {  
       fa="/research/groups/cab/projects/automapper/common/zhongshan/test/NGS_Pipelines/arc-resource/resources/genome-resources-persistent/Homo_sapiens.GRCh38_r97.all.fa"
//"/research/rgs01/project_space/cab/automapper/common/yhui/Zhongshan/test/NGS_Pipelines/arc-Apr-2022/arc-fusion-resource-bundle/resources/genome-resources-persistent/Homo_sapiens.GRCh38_r97.all.fa"
       //"/home/wzhang42/BALL_Classifier/nf_core/Reference/ensembl/Homo_sapiens.GRCh38.102.all.fa"
       // The path for Arriba reference 
       gtf="/research/groups/cab/projects/automapper/common/zhongshan/test/NGS_Pipelines/arc-resource/resources/genome-resources-persistent/Homo_sapiens.GRCh38_r97.gtf"
//"/research/rgs01/project_space/cab/automapper/common/yhui/Zhongshan/test/NGS_Pipelines/arc-Apr-2022/arc-fusion-resource-bundle/resources/genome-resources-persistent/Homo_sapiens.GRCh38_r97.gtf"
       //"/home/wzhang42/BALL_Classifier/nf_core/Reference/ensembl/Homo_sapiens.GRCh38.102.gtf"
       // The path for Arriba' gtf 
       blacklist="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Arriba_ref/blacklist_hg38_GRCh38_v2.3.0.tsv.gz"
       // /research/rgs01/project_space/cab/automapper/common/yhui/Zhongshan/test/NGS_Pipelines/arc-Apr-2022/arc-fusion-resource-bundle/resources/genome-resources-persistent/arriba/blacklist_hg38_GRCh38_2018-11-04.tsv
       // blacklist="/usr/local/var/lib/arriba/blacklist_hg38_GRCh38_v2.3.0.tsv.gz"   
       known_fusion_k="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Arriba_ref/known_fusions_hg38_GRCh38_v2.3.0.tsv.gz"
       // "/home/wzhang42/BALL_Classifier/Arriba_ref/known_fusions_hg38_GRCh38_v2.3.0.tsv.gz"
       // known_fusion_k="/usr/local/var/lib/arriba/known_fusions_hg38_GRCh38_v2.3.0.tsv.gz"
       known_fusion_t="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Arriba_ref/known_fusions_hg38_GRCh38_v2.3.0.tsv.gz"
       // known_fusion_t="/usr/local/var/lib/arriba/known_fusions_hg38_GRCh38_v2.3.0.tsv.gz"
       protein_domains="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Arriba_ref/protein_domains_hg38_GRCh38_v2.3.0.gff3"
       // protein_domains="/usr/local/var/lib/arriba/protein_domains_hg38_GRCh38_v2.3.0.gff3"
   }
   
   RSEM {
    ThreadN = 4
    // Thread Number for RSEM
    Ref="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/RSEM-index/v1.3.3/GRCh38.primary_assembly.genome"
    //"/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/RSEM-index/v1.3.1/GRCh38.primary_assembly.genome"
    //"/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/RSEM-index/v1.3.3/GRCh38.primary_assembly.genome"
    // "/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode/r31/RSEM-index/v1.3.3/GRCh38.primary_assembly.genome"
    // The path for RSEM Reference
   }

   ML_Classifier {
      RScript_Path="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/ML_Classifier"    
      //"/home/wzhang42/Nextflow_DIVIA/ML_Classifier"
      BALL {
         RANK_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/ML_Classifier/RANK_model.rds"
          //"/home/wzhang42/Nextflow_DIVIA/ML_Classifier/SJBALL1425_TPS_allSample_trainclassifier_codingGene.rds"
         RF_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/ML_Classifier/RF_model.rds"
      }

      TALL {
          RANK_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/TALL/SJTALL_937_TPS_trainclassifier_linc_codingGene_bc0_1000.rds"
          //RANK_Training_RDS=" /research/groups/cab/projects/automapper/common/DIVIA/ref_data/TALL/SJTLL783_SJonly_TPS_trainclassifier_linc_codingGene_1000.rds"
          RF_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/ML_Classifier/RF_model.rds"
      }
      
      AML {
          RANK_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/AML/SJAML_658_TPS_trainclassifier_linc_codingGene_bc1_500.rds"
          //RANK_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/AML/SJAML668_SJonly_TPS_trainclassifier_linc_codingGene_1000.rds"        
          RF_Training_RDS="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/ML_Classifier/RF_model.rds"
      }

      tSNE {
          LibraryType="Stranded_total_RNA_PE100bp"
          // Stranded_total_RNA_PE100bp|Stranded_total_RNA_PE125bp |Stranded_total_RNA_PE75bp |
          // Stranded_total_RNA_PE75bp-TARGET |Unstranded_mRNA_PE100bp |Unstranded_mRNA_PE75bp
          Metadata="${fastq_filelist}"
          ReferenceMetaData="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/BALL/1452_TPM_COUNT/SJBALL1452_meta_simplified.txt"
          ReferenceCountsFile="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/BALL/1452_TPM_COUNT/SJBALL1452_count.txt"
          Top1kGenesFile="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/BALL/1452_TPM_COUNT/STD-BALL-top1kMadGenesGRch38v31.txt"
          //stdFile="/rgs01/project_space/cab/automapper/common/DIVIA/ref_data/BALL/1452_TPM_COUNT/input.STD-BALL-1452S-tSNE-plot_GRch38v31.txt"
          // id2geFile="/rgs01/project_space/cab/automapper/common/DIVIA/ref_data/BALL/etc/geneID2symbol_GRCh38_31.txt"
          // codingGenesFile="/rgs01/project_space/cab/automapper/common/DIVIA/ref_data/BALL/etc/ENSGgenesGRch38v31_coding12.txt"
      }      

   }

   GATK {
        Ref="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/bwa-index/0.7.17-r1188/GRCh38.primary_assembly.genome.fa"
       // "${REF_DIR}/GRCh38_no_alt/bwa-index/0.7.17-r1188/GCA_000001405.15_GRCh38_no_alt_analysis_set.fa"
	   KNOWN_SITE1="/research/groups/cab/projects/automapper/common/yhui/Ti-Cheng/snv/GATK_known_sites/hg38/Homo_sapiens_assembly38.known_indels.vcf.gz"
	   KNOWN_SITE2="/research/groups/cab/projects/automapper/common/yhui/Ti-Cheng/snv/GATK_known_sites/hg38/resources_broad_hg38_v0_Homo_sapiens_assembly38.dbsnp138.vcf"
	   KNOWN_SITE3="/research/groups/cab/projects/automapper/common/yhui/Ti-Cheng/snv/GATK_known_sites/hg38/resources_broad_hg38_v0_Mills_and_1000G_gold_standard.indels.hg38.vcf"
   }

   VarDict {
      CALLBED ="/research/groups/cab/projects/Control/common/scripts/VariantCalling/beta/SV/bed/ITD.hg38.bed"
      REFERENCE ="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/NCBI/GRCh38_no_alt/bwa-index/0.7.17-r1188/GCA_000001405.15_GRCh38_no_alt_analysis_set.fa"
      ThreadN=4
   }
  
   ANNOVAR
   {
     ANNOVAR_PATH="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/Variant_ANNOVAR"
     //"/hpcf/apps/annovar/install/030717"
     // The path for perl script table_annovar.pl
     ANNOVAR_DB="/research/groups/cab/projects/Control/common/scripts/VariantCalling/beta/REF/Homo_sapiens/Annovar/humandb"
     // Database for ANNOVAR 
     REF_BUILD="hg38"
     // Reference Build for ANNOVAR , hg38|h18|hg19
     
     CONFIG_ANNOVAR="-F ANNOVAR_DATE -F Func.refGene -F Gene.refGene -F GeneDetail.refGene -F ExonicFunc.refGene -F AAChange.refGene -F 1000g2015aug_all -F ExAC_ALL -F ExAC_AFR -F ExAC_AMR -F ExAC_EAS -F ExAC_FIN -F ExAC_NFE -F ExAC_OTH -F ExAC_SAS -F ExAC_nontcga_ALL -F ExAC_nontcga_AFR -F ExAC_nontcga_AMR -F ExAC_nontcga_EAS -F ExAC_nontcga_FIN -F ExAC_nontcga_NFE -F ExAC_nontcga_OTH -F ExAC_nontcga_SAS -F esp6500siv2_all -F gnomAD_exome_ALL -F gnomAD_exome_AFR -F gnomAD_exome_AMR -F gnomAD_exome_ASJ -F gnomAD_exome_EAS -F gnomAD_exome_FIN -F gnomAD_exome_NFE -F gnomAD_exome_OTH -F gnomAD_exome_SAS -F gnomAD_genome_ALL -F gnomAD_genome_AFR -F gnomAD_genome_AMR -F gnomAD_genome_ASJ -F gnomAD_genome_EAS -F gnomAD_genome_FIN -F gnomAD_genome_NFE -F gnomAD_genome_OTH -F SIFT_score -F SIFT_converted_rankscore -F SIFT_pred -F Polyphen2_HDIV_score -F Polyphen2_HDIV_rankscore -F Polyphen2_HDIV_pred -F Polyphen2_HVAR_score -F Polyphen2_HVAR_rankscore -F Polyphen2_HVAR_pred -F LRT_score -F LRT_converted_rankscore -F LRT_pred -F MutationTaster_score -F MutationTaster_converted_rankscore -F MutationTaster_pred -F MutationAssessor_score -F MutationAssessor_score_rankscore -F MutationAssessor_pred -F FATHMM_score -F FATHMM_converted_rankscore -F FATHMM_pred -F PROVEAN_score -F PROVEAN_converted_rankscore -F PROVEAN_pred -F VEST3_score -F VEST3_rankscore -F MetaSVM_score -F MetaSVM_rankscore -F MetaSVM_pred -F MetaLR_score -F MetaLR_rankscore -F MetaLR_pred -F M-CAP_score -F M-CAP_rankscore -F M-CAP_pred -F REVEL_score -F REVEL_rankscore -F MutPred_score -F MutPred_rankscore -F CADD_raw -F CADD_raw_rankscore -F CADD_phred -F DANN_score -F DANN_rankscore -F fathmm-MKL_coding_score -F fathmm-MKL_coding_rankscore -F fathmm-MKL_coding_pred -F Eigen_coding_or_noncoding -F Eigen-raw -F Eigen-PC-raw -F GenoCanyon_score -F GenoCanyon_score_rankscore -F integrated_fitCons_score -F integrated_fitCons_score_rankscore -F integrated_confidence_value -F GERP++_RS -F GERP++_RS_rankscore -F phyloP100way_vertebrate -F phyloP100way_vertebrate_rankscore -F phyloP20way_mammalian -F phyloP20way_mammalian_rankscore -F phastCons100way_vertebrate -F phastCons100way_vertebrate_rankscore -F phastCons20way_mammalian -F phastCons20way_mammalian_rankscore -F SiPhy_29way_logOdds -F SiPhy_29way_logOdds_rankscore -F Interpro_domain -F GTEx_V6p_gene -F GTEx_V6p_tissue -F REVEL -F dbscSNV_ADA_SCORE -F dbscSNV_RF_SCORE -F cosmic70 -F nci60 -F CLNALLELEID -F CLNDN -F CLNDISDB -F CLNREVSTAT -F ALLELE_END -F InterVar_automated -F PVS1 -F PS1 -F PS2 -F PS3 -F PS4 -F PM1 -F PM2 -F PM3 -F PM4 -F PM5 -F PM6 -F PP1 -F PP2 -F PP3 -F PP4 -F PP5 -F BA1 -F BS1 -F BS2 -F BS3 -F BS4 -F BP1 -F BP2 -F BP3 -F BP4 -F BP5 -F BP6 -F BP7 -F dbscSNV_ADA_SCORE -F dbscSNV_RF_SCORE -F cosmic70 -F nci60 -F CLNALLELEID -F CLNDN -F CLNDISDB -F CLNREVSTAT -F CLNSIG -F ALLELE_END"
     CONFIG_STANDARD="-F CHROM -F POS -F ID -F REF -F ALT -F QUAL -F FILTER"
     CONFIG_INFO="-F DP -F SOMATIC -F SS -F SSC -F GPV -F SPV"
     CONFIG_FORMAT="-GF GT -GF GQ -GF DP -GF RD -GF AD -GF FREQ -GF DP4"
   }

   RNASeq_CNV
   {
     RScript_Path="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia/Module_Scripts/RNASeq_CNV"
   }

   RNAIndel 
   {
     Ref_Fa="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/STAR-index/2.7.9a/GRCh38.primary_assembly.genome.fa"
     // Reference required in RNAIndel, must corresponds to the reference used in STAR-Mapping.
     //"/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/NCBI/GRCh38_no_alt/bwa-index/0.7.17-r1188/GCA_000001405.15_GRCh38_no_alt_analysis_set.fa"
     // "/research/rgs01/reference/public/genomes/Homo_sapiens/GRCh38_no_alt/FASTA/chromosomes/chr10.fa"    
     Database_model="/research/groups/cab/projects/automapper/common/DIVIA/ref_data/rnaindel/data_dir_grch38"
     // Database_model="/research/rgs01/home/clusterHome/wzhang42/Misc_Database/RNAIndel_Database_Model/data_dir_grch38"

     ThreadN = 4    
     CONFIG_STANDARD="-F CHROM -F POS -F ID -F REF -F ALT -F QUAL -F FILTER"
     CONFIG_INFO="-F predicted_class -F probabilities -F annotation -F cosmic_cnt -F maximum_population_frequency -F COMMON -F repeat -F lc -F local_lc -F gc -F local_gc -F strength -F local_strength -F dissimilarity -F indel_complexity -F indel_size -F INS -F AT_INS -F AT_DEL -F GC_INS -F GC_DEL -F ref_count -F alt_count -F BIDIRECTIONAL -F UNIQ_MAPPED -F NEAR_EXON_BOUNDARY -F EQUIVALENCE_EXISTS -F MULTIALLELIC -F INFRAME -F SPLICE -F TRUNCATING -F CONSERVED_DOMAIN -F indel_location -F NMD_INSENSITIVE -F indel_per_gene -F coding_sequence_length -F GERMLINE_DB -F RECLASSIFIED -F OUTLYING -F CALLER"
     CONFIG_FORMAT="-GF AD"
   }
   
   Pindel
   { 
     ThreadN = 8
     Ref="/research/rgs01/applications/hpcf/authorized_apps/cab/Automation/REF/Homo_sapiens/Gencode_ERCC92/r31/bwa-index/0.7.17-r1188/GRCh38.primary_assembly.genome.fa"
     ITD_BED="/research/groups/cab/projects/Control/common/scripts/VariantCalling/beta/SV/bed/ITD.hg38.bed"
     REF_BUILD="hg38"
     REF_Date="20200328"
     InsertSize=450
     Min_Coverage=1
     Het_Cutoff=0.01
     Hom_Cutoff=0.99
   }

   iAdmix
   {
      AFFILE="/research_jude/rgs01_jude/groups/cab/projects/automapper/common/DIVIA/ref_data/popuFreq/thou.omni.hg38.ref.chr.txt"
      // Allele frequency file that can used in iAdMix 
      iAdmix_PATH="/hpcf/authorized_apps/rhel7_apps/iadmix/vendor/iAdmix"
        
   }

   containerPath="/research/groups/cab/projects/automapper/common/DIVIA/Nextflow_Divia"
   ///containerPath="/home/wzhang42/Nextflow_DIVIA"
   //"/home/wzhang42/Nextflow_DIVIA"
   // "./DIVIA_Container"
   // The path for contianer
   
   TMP_DIR="/scratch_space/wzhang42/tmp" ///scratch_space/wzhang42/tmp_DIVIA_TALL // "/lustre_scratch/user_scratch/wzhang42/tmp"
   // Tempoary Directory that used to store the intermediate files.   
   
   R_4_2_LIBS= "/home/wzhang42/R/tmp/x86_64-pc-linux-gnu-library/rhel8_4.2"  //"/home/wzhang42/R/tmp/x86_64-pc-linux-gnu-library/4.2"
   R_4_1_LIBS= "/home/wzhang42/R/tmp/x86_64-pc-linux-gnu-library/rhel8_4.1"   //"/home/wzhang42/R/tmp/x86_64-pc-linux-gnu-library/4.1"
    
   outdir= "./" 
   //"/research/dept/cab/common/Wenchao_share"    // "./"
   //"/research/groups/cab/projects/automapper/common/wzhang42/E1910_RNA" //./DIVIA_Result"  
   // Output dir for storing the intermediate publishedDir     
}

profiles {
      
    local {
        process.executor = 'local'
        
        process {
            withName: Zcat_MergeFastq {
            memory = '8GB'
            }
        }
      
        process {
            withName: Trim_Galore {
            module = ['trimgalore/0.6.6', 'cutadapt/4.4']
            // module = ['trimgalore/0.6.6', 'fastqc/0.11.8', 'python/3.5.2', 'cutadapt/4.4']
            memory = '8GB' 
            }
        }
        
        process {
            withName: Trim_Galore_Adaptor_STARMapping {
            memory = '2GB'
            }
        }
        
        process {
            withName: Fusion_Catcher {
            module = 'fusioncatcher/1.33'
            cpus= "${params.Fusion_Catcher.ThreadN}"
            memory = '64GB'
            }
        }
        
        process {
            withName: STAR_Mapping {
            module = 'star/2.7.9a'
//          module = 'star/2.7.9a'
//          module = 'star/2.7.10a'
//          module = 'star/2.7.0f'
            cpus= "${params.STAR_Mapping.ThreadN}"
            memory = '32GB'  
            }
        }

        process {    
            withName: STARMapping_Adaptor_STAR_Fusion {
            memory = '4GB'
	        }  
        }
        
        process {    
            withName: STARMapping_Adaptor_Arriba_Fusion {
            memory = '4GB'
	        }  
        }

        process {    
            withName: STARMapping_Adaptor_RNAseq_RSEM {
            memory = '4GB'
	        }  
        }

        process {
            withName: STARMapping_MarkDuplicate {
            module = ['samtools/1.17', 'gatk/4.1.8.0']
            memory = '64GB'
            }
        }

        process {    
            withName: STARMapping_Adaptor_RNAvar_GATK {
            // module = 'samtools/1.17'
            memory = '4GB'
	        }  
        }

        process {
            withName: STARMapping_Adaptor_Pindel {
            module = 'samtools/1.17'
            memory = '4GB'
            }
        }
        
        process {
            withName: STARMapping_Adaptor_iAdmix  {
            memory = '4GB'
            }
        }
        
        process {
            withName: STARMapping_Adaptor_RNAIndel {
            memory = '2GB'
            }
        }
              
        process {    
            withName: STAR_Fusion {
	        module = 'star-fusion/1.6.0'  
            memory = '32GB'
	        }  
        }
        
        process {
            withName: Arriba_Fusion {
            module = 'arriba/2.4.0' 
            memory = '80GB'           
            }
        }
        
        process {
            withName: RNAseq_RSEM {
            module = 'rsem/1.3.1'
            memory = '80GB'           
            }
        }
        
        process {
            withName: Get_ExpectedCount_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        }
        
        process {
            withName: Get_ModifiedCount_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        } 

        process {
            withName: Get_TPM_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        }

        process {
            withName: Get_FPKM_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        }
        
        process { 
            withName: ML_Classifier_RANK {
            module = 'R/4.2.0-rhel8'
            memory = '16GB'
            }
        }
        
        process { 
            withName: ML_Classifier_RF {
            module = 'R/4.2.0-rhel8'
            memory = '32GB'
            }
        }
        
        process { 
            withName: ML_Classifier_tSNE {
            module = 'R/4.2.0-rhel8'
            memory = '16GB'
            }
        }

        /*
        process {
            withName: RNAvar_GATK {
            module = 'gatk/4.1.8.0' 
            memory = '80GB'           
            }
        } 
        */

         process {
            withName: GATK_SplitNCigarReads {
            module = 'gatk/4.1.8.0' 
            memory = '64GB'
            }
        }

        process {
            withName: GATK_BaseRecalibrator {
            module = 'gatk/4.1.8.0' 
            memory = '32GB'
            }
        }
        
        process {
            withName: GATK_ApplyBQSR {
            module = 'gatk/4.1.8.0' 
            memory = '32GB'
            }
        }
        
        process { 
            withName: VarDict {
            module = ['vardict/1.8.3', 'tabix/0.2.6']  // must not include 'R/4.1.2-rhel8'
            memory = '32GB'
            }
        }

        process {
            withName: GATK_HaplotypeCaller {
            module = 'gatk/4.1.8.0' 
            memory = '64GB'
            }
        }
        
        process {
            withName: GATK_HaplotypeCaller_perChrom {
            module = 'gatk/4.1.8.0' 
            memory = '16GB'
            }
        }

        process {
            withName: MergeVCF {
            module = 'gatk/4.1.8.0' 
            memory = '16GB'
            }
        }

        process {
            withName: GATK_VariantFiltration {
            module = 'gatk/4.1.8.0' 
            memory = '32GB'
            }
        }
        
        process {
            withName: Variant_ANNOVAR {
            module = ['perl/5.28.1', 'tabix/0.2.6', 'gatk/4.1.8.0'] 
            memory = '32GB'
            }
        }
        
        process {
            withName: RNASeqCNV {
            module = 'R/4.1.0' 
            memory = '32GB'
            }
        } 
        
        process {
           withName: RNAIndel {
           module =  ['rnaindel/3.3.5', 'tabix/0.2.6', 'gatk/4.1.8.0'] // 'python/3.11.0' 
           memory = '32GB'
           cpus= "${params.RNAIndel.ThreadN}"
           }
        }

        process {
            withName: Pindel {
            module = 'pindel/0.2.4' 
            memory = '32GB'
            cpus= "${params.Pindel.ThreadN}"
            }
        } 
        
        process {
            withName: Pindel2VCF {
            module = ['pindel/0.2.4', 'tabix/0.2.6', 'bcftools/1.14' ] 
            memory = '32GB'
            }
        } 
        
        process {
            withName: iAdmix {
            module = 'iadmix/c188a70-rhel7' 
            memory = '32GB'
            }
        }        
    }
 
    cluster {
        process.executor = 'lsf'
        executor.queueSize = 500
        process.queue = 'rhel8_heavy_io' //'rhel8_standard'  // 'priority'
        process.scratch=true
        process.scratch='/scratch_space/wzhang42/tmp'
        process.clusterOptions = '-P Test'
        executor.jobName = { "$task.name - $task.hash" }  
        
        process {
            withName: Zcat_MergeFastq {
            memory = '8GB'
            }
        }
      
        process {
            withName: Trim_Galore {
            module = ['trimgalore/0.6.6', 'cutadapt/4.4']
            // module = ['trimgalore/0.6.6', 'fastqc/0.11.8', 'python/3.5.2', 'cutadapt/4.4']
            memory = '8GB' 
            }
        }
        
        process {
            withName: Trim_Galore_Adaptor_STARMapping {
            memory = '2GB'
            }
        }
        
        process {
            withName: Fusion_Catcher {
            module = 'fusioncatcher/1.33'
            cpus= "${params.Fusion_Catcher.ThreadN}"
            memory = '64GB'
            }
        }
        
        process {
            withName: STAR_Mapping {
            module = 'star/2.7.9a'
//          module = 'star/2.7.9a'
//          module = 'star/2.7.10a'
//          module = 'star/2.7.0f'
            cpus= "${params.STAR_Mapping.ThreadN}"
            memory = '32GB'  
            }
        }

        process {    
            withName: STARMapping_Adaptor_STAR_Fusion {
            memory = '4GB'
	        }  
        }
        
        process {    
            withName: STARMapping_Adaptor_Arriba_Fusion {
            memory = '4GB'
	        }  
        }

        process {    
            withName: STARMapping_Adaptor_RNAseq_RSEM {
            memory = '4GB'
	        }  
        }

        process {
            withName: STARMapping_MarkDuplicate {
            module = ['samtools/1.17', 'gatk/4.1.8.0']
            memory = '64GB'
            }
        }

        process {    
            withName: STARMapping_Adaptor_RNAvar_GATK {
            // module = 'samtools/1.17'
            memory = '4GB'
	        }  
        }
        
        process {
            withName: STARMapping_Adaptor_Pindel {
            module = 'samtools/1.17'
            memory = '4GB'
            }
        }
        
        process {
            withName: STARMapping_Adaptor_iAdmix {
            memory = '4GB'
            }
        }

        process {
            withName: STARMapping_Adaptor_RNAIndel {
            memory = '2GB'
            }
        }

        process {    
            withName: STAR_Fusion {
            module = 'star-fusion/1.6.0'
	    // module = ['star-fusion/1.6.0', 'gcc/8.3.0', 'perl/5.28.1']  
            // 'star-fusion/1.2.0'
            cpus = "${params.STAR_Fusion.ThreadN}"
            memory = '32GB'
	    }  
        }
        
        process {
            withName: Arriba_Fusion {
            module = 'arriba/2.4.0'
            memory = '100GB'           
            }
        }
        
        process {
            withName: RNAseq_RSEM {
            module = 'rsem/1.3.1'
            memory = '100GB'           
            }
        }

        process {
            withName: Get_ExpectedCount_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        }
        
        process {
            withName: Get_ModifiedCount_Matrix {
            module = 'rsem/1.3.1'
            memory = '32GB'
            }
        }

        process {
            withName: Get_TPM_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        }

        process {
            withName: Get_FPKM_Matrix {
            module = 'rsem/1.3.1'
            memory = '8GB'
            }
        }
        
        process { 
            withName: ML_Classifier_RANK {
            module = 'R/4.2.0-rhel8' //'R/4.2.0'
            memory = '16GB'
            }
        }
        
        process { 
            withName: ML_Classifier_RF {
            module = 'R/4.2.0-rhel8' //'R/4.2.0'
            memory = '32GB'
            }
        }
        
        process { 
            withName: ML_Classifier_tSNE {
            module = 'R/4.2.0-rhel8' //'R/4.2.0'
            memory = '16GB'
            }
        }
        
        process {
            withName: GATK_SplitNCigarReads {
            module = 'gatk/4.1.8.0' 
            memory = '64GB'
            }
        }

        process {
            withName: GATK_BaseRecalibrator {
            module = 'gatk/4.1.8.0' 
            memory = '64GB'
            }
        }
        
        process {
            withName: GATK_ApplyBQSR {
            module = 'gatk/4.1.8.0' 
            memory = '64GB'
            }
        }
        
        process { 
            withName: VarDict {
            module = ['vardict/1.8.3', 'tabix/0.2.6']   // must not include 'R/4.1.2-rhel8', vardict have contianed it already 
            memory = '64GB'
            }
        }

        process {
            withName: GATK_HaplotypeCaller {
            module = 'gatk/4.1.8.0' 
            memory = '64GB'
            }
        }
        
        process {
            withName: GATK_HaplotypeCaller_perChrom {
            module = 'gatk/4.1.8.0' 
            memory = '16GB'
            }
        }

        process {
            withName: MergeVCF {
            module = 'gatk/4.1.8.0' 
            memory = '16GB'
            }
        }

        process {
            withName: GATK_VariantFiltration {
            module = 'gatk/4.1.8.0' 
            memory = '32GB'
            }
        }
        
        process {
            withName: Variant_ANNOVAR {
            module = ['perl/5.28.1', 'tabix/0.2.6', 'gatk/4.1.8.0'] 
            memory = '32GB'
            }
        }
        
        process {
            withName: RNASeqCNV {
            module = 'R/4.1.0-rhel8' //'R/4.1.0' 
            memory = '32GB'
            //env.R_LIBS="~/R/tmp/x86_64-pc-linux-gnu-library/4.1"         
            }
        }
        
        process {
           withName: RNAIndel {
           module = ['rnaindel/3.3.5', 'tabix/0.2.6', 'gatk/4.1.8.0'] // 'python/3.11.0' 
           memory = '64GB'
           cpus= "${params.RNAIndel.ThreadN}"
           }
        }

        process {
            withName: Pindel {
            module = 'pindel/0.2.4' 
            memory = '32GB'
            cpus= "${params.Pindel.ThreadN}"
            }
        } 
        
        process {
            withName: Pindel2VCF {
            module = ['pindel/0.2.4', 'tabix/0.2.6', 'bcftools/1.14' ] 
            memory = '32GB'
            }
        } 
        
        process {
            withName: iAdmix {
            module = 'iadmix/c188a70-rhel7' 
            memory = '32GB'
            // iAdmix_PATH="/hpcf/authorized_apps/rhel7_apps/iadmix/vendor/iAdmix"
            // can be got by "1.) module load iadmix/c188a70-rhel7,  2.) which ANCESTRY|sed -e 's/\/ANCESTRY//g'"
            }
        }   
        
    }

    singularity {
        process.executor = 'lsf'
        executor.queueSize = 500
        process.queue =  'priority'
        process.scratch=true
        process.clusterOptions = '-P Test'
        executor.jobName = { "$task.name - $task.hash" }  

        singularity.enabled    = true
        singularity.autoMounts = true
        //containerOptions = "--env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion/ctat-genome-lib-builder:/usr/local/STAR-Fusion:/usr/local/RSEM:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" 
                             
        process {
            withName: Zcat_MergeFastq {
            memory = '8GB'
            }
        }
      
        process {
            withName: Trim_Galore {     
            memory = '8GB' 
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }  

        process {
            withName: Trim_Galore_Adaptor_STARMapping {
            memory = '2GB'
            }
        }    
        
        process {
            withName: STAR_Mapping {
            memory = '64GB'
            container= "file:///${params.containerPath}/DIVIA.sif"  
            //container= "file:///${params.containerPath}/docker.io-trinityctat-starfusion-1.10.1.img"
            }
        }
        
        process {    
            withName: STARMapping_Adaptor_STAR_Fusion {
            memory = '4GB'
	        }  
        }
        
        process {    
            withName: STARMapping_Adaptor_Arriba_Fusion {
            memory = '4GB'
	        }  
        }

        process {    
            withName: STARMapping_Adaptor_RNAseq_RSEM {
            memory = '4GB'
	        }  
        }

        process {    
            withName: STARMapping_Adaptor_RNAvar_GATK {
            memory = '4GB'
	        }  
        }

        process {    
            withName: STAR_Fusion {
            memory = '64GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            //container= "file:///${params.containerPath}/docker.io-trinityctat-starfusion-1.10.1.img"
            //containerOptions = "--cleanenv --env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion-v1.6.0/ctat-genome-lib-builder:/usr/local/STAR-Fusion-v1.6.0:/usr/local/RSEM:$PATH --env LD_LIBRARY_PATH=/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH" 
            //containerOptions = "--env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion/ctat-genome-lib-builder:/usr/local/STAR-Fusion:/usr/local/RSEM:$PATH" 
            //env.SINGULARITYENV_APPEND_PATH="/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion/ctat-genome-lib-builder:/usr/local/STAR-Fusion:/usr/local/RSEM"
	    }  
        }
               
        process {
            withName: Arriba_Fusion {
            memory = '64GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            //container= "file:///${params.containerPath}/depot.galaxyproject.org-singularity-arriba-2.1.0--h3198e80_1.img"
            //container= "file:///${params.containerPath}/depot.galaxyproject.org-singularity-arriba-2.3.0--haa8aa89_0.img"           
            //env.SINGULARITYENV_APPEND_PATH="/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion/ctat-genome-lib-builder:/usr/local/STAR-Fusion:/usr/local/RSEM"
            //containerOptions = "--env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion-v1.6.0/ctat-genome-lib-builder:/usr/local/STAR-Fusion-v1.6.0:/usr/local/RSEM:$PATH" 
            //containerOptions = "--env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion/ctat-genome-lib-builder:/usr/local/STAR-Fusion:/usr/local/RSEM:$PATH" 
            }
        }
        
        process {
            withName: RNAseq_RSEM { 
            memory = '80GB' 
            container= "file:///${params.containerPath}/DIVIA.sif"
            //containerOptions = "--env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion-v1.6.0/ctat-genome-lib-builder:/usr/local/STAR-Fusion-v1.6.0:/usr/local/RSEM:$PATH" 
            //containerOptions = "--env PATH=/usr/local/arriba_v2.3.0:/usr/local/STAR-Fusion/ctat-genome-lib-builder:/usr/local/STAR-Fusion:/usr/local/RSEM:$PATH" 
            }
        }

        process {
            withName: Get_ExpectedCount_Matrix {
            memory = '8GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }
        
        process {
            withName: Get_ModifiedCount_Matrix {      
            memory = '8GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        } 

        process {
            withName: Get_TPM_Matrix {
            memory = '8GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }

        process {
            withName: Get_FPKM_Matrix {
            memory = '8GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }
        
        process { 
            withName: ML_Classifier_RANK {
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            containerOptions="--app Rscript"
             // containerOptions = "--env R_LIBS=/library:/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library"
            }
        }
        
        process { 
            withName: ML_Classifier_RF {
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            containerOptions="--app Rscript"
            //containerOptions = "--env R_LIBS=/library:/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library"
            }
        }
        
        process { 
            withName: ML_Classifier_tSNE {
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            containerOptions="--app Rscript"
            //containerOptions = "--env R_LIBS=/library:/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library"
            }
        }
        
        process {
            withName: GATK_SplitNCigarReads { 
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }

        process {
            withName: GATK_BaseRecalibrator { 
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }
        
        process {
            withName: GATK_ApplyBQSR {  
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }

        process {
            withName: GATK_HaplotypeCaller {
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }

        process {
            withName: GATK_VariantFiltration { 
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }
        
        process {
            withName: Variant_ANNOVAR {
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            }
        }
        
        process {
            withName: RNASeqCNV {
            memory = '32GB'
            container= "file:///${params.containerPath}/DIVIA.sif"
            //containerOptions = "--env R_LIBS=/library:/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library"
            }
        }               

    }
}
